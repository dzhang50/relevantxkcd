<!DOCTYPE html>
<!-- NOT USING vvvvvvv -- instead HTML5 -->
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
    <meta charset="UTF-8">
    <title>Relevant XKCD</title>
    <!-- <link rel="stylesheet" href="css/bootstrap.css"  type="text/css"/>-->
    <link rel="stylesheet" href="css/custom.css"  type="text/css"/>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//malsup.github.io/jquery.blockUI.js"></script>
  	<script src="js/heartcode-canvasloader-min.js"></script>
  	<script type="text/javascript">
  	var uiBlocked = false;
  	var lastQuery = "";
  	var altComic = "";
  	var selection = 0;
  	var curSelection = 0;
  	var comics = [];
  	var lastAltComicIdx = -1;
    
    function trainTrue() {
    	jQuery.get('process?action=train&idx='+curSelection+'&query='+lastQuery, function(data) {
    		// do nothing
    		$("#training").fadeOut("slow", function() {
    			document.getElementById("training").innerHTML = "Thanks for the feedback!<br><br>";
    			$("#training").fadeIn("slow");
    			setTimeout(function(){$("#training").fadeOut("slow"); }, 2000);
    		});
		});
    }
    
    function showFalse() {
    	if(lastAltComicIdx+1 == comics.length) {
    		$("#training").fadeOut("slow", function() {
    			var q = "No more options! Sorry we give up (for now)...<br><br>";
    			document.getElementById("training").innerHTML = q;
    		
    			$("#training").fadeIn("slow");
    		});
    		return;
    	}
    	
    	
    	$("#training").fadeOut("slow", function() {
    		var q = "How about this? <button onclick=\"trainTrue(); return false;\">Yes</button> <button onclick=\"showFalse(); return false;\">No</button><br><br>";
    		document.getElementById("training").innerHTML = q;
    		
    		$("#training").fadeIn("slow");
    	});
    	
    	$("#comic").fadeOut("slow", function() {
    		var lines = "";
    		for(var i = lastAltComicIdx+1; i < comics.length; i++) {
    			if(i != selection) {
    				lines = "<img src='http://www.explainxkcd.com/"+comics[i]+"'  /></br><br/>";
    				document.getElementById("comic").innerHTML=lines;
    				lastAltComicIdx = i;
    				curSelection = i;
    				$("#comic").fadeIn("slow");
    				return;
    			}
    		}
    	});
    }
    
    function sendQuery() {
    	query = $("#query").val();
    	lastQuery = query;
    	document.getElementById("comic").innerHTML = "loading...<br/><br/>";
    
    	document.getElementById("subcomic").disabled = true;
    	jQuery.get('process?action=xkcd&query='+query, function(data) {
    		data = data.trim();
   			resp(data.split(" "));
		});
		document.getElementById("subcomic").disabled = false;

		return false;
    }
    
    function resp(data) {
    	var lines = "";
    	selection = parseInt(data[0]);
    	curSelection = selection;
    	lastAltComicIdx = -1;
    	
    	document.getElementById("training").innerHTML = "Was this accurate? <button onclick=\"trainTrue(); return false;\">Yes</button> <button onclick=\"showFalse(); return false;\">No</button><br><br>";
		$("#training").fadeIn("slow");
    	for (var i = 1; i < data.length; i++) {
    		comics[i-1] = data[i];
		}
		
		lines = "<img src='http://www.explainxkcd.com/"+comics[selection]+"'  /></br><br/>";
		
    	document.getElementById("comic").innerHTML=lines;
    }
    
	function aboutClick() {
		//show the loading bar
		showLoading();
		//load selected section
		switch(this.id){
			case "about":
				content.load(aboutcode, hideLoading);
			default:
				//hide loading bar if there is no selected section
				hideLoading();
				break;
		}
	}

	//show loading bar
	function showLoading(){
		loading
			.css({visibility:"visible"})
			.css({opacity:"1"})
			.css({display:"block"})
		;
	}
	//hide loading bar
	function hideLoading(){
		loading.fadeTo(1000, 0);
	}

    </script>
  </head>
  
  
  <!-- XKCD structure -->
  
  <body>
<div id="topContainer">
<div id="topLeft">
<ul>
<li><a href="/">Home</a></li>
<li><a href="#about">About</a></li>
<li><a href="https://www.hackerleague.org/hackathons/hacktx">HackTX</a></li>
</ul>
</div>
<div id="topRight">
<div id="masthead">
<span><a href="/"><img src="img/xkcdlogo.png" alt="xkcd.com logo" height="83" width="185"/></a></span>
<span id="slogan">Find the xkcd comic <br/>you are looking for.</span>
</div>
</div>
<div id="bgLeft" class="bg box"></div>
<div id="bgRight" class="bg box"></div>
</div>
<div id="middleContainer" class="box">

<div id="ctitle">There's Always a Relevant xkcd</div>
<br/><br/>
            <form name="inputBox" class="form-search">
          	<input type="text" name="query" id="query" placeholder="Search Here"/><button type="submit" id="subcomic" name="subcomic" class="btn" onclick="sendQuery(); return false;">xkcd me!</button>
          	</form>  <br/>
          	
<div id="loader"></div>
<div id="training"></div>
<div id="comic">
<br><br>
<!--   img src="http://www.explainxkcd.com//wiki/images/4/4f/online_communities_small.png"/ -->
</div>
</div>

<div id="bottom" class="box">
<a name="about"></a>
<div id="ctitle">About</div>
<p>
It is known that there's always a relevant XKCD comic regardless of the
 situation. We prove this with our website! Users simply enter a sentence or 
 two and the page shows the relevant XKCD comic.
<a href="http://www.danzhang.net">Dan Zhang</a> and 
<a href="http://www.maruthven.com">Megan Ruthven</a> created this website 
to exemplify this phenomenon. Relevant XKCD pulls information from the title and
content each image to compare against your request. 
</p>
<p>
Try it out by typing in a description of a comic you are looking for and wait 
for it to appear before your very eyes! We suggest writing longer sentences 
gives our algorithm more data to work with.
</p>
<p>
These images are from the original
<a href="http://www.xkcd.com">xkcd online comic</a>. We do not claim these 
images as our own work, but we do claim they are awesome!
</p>
</div>
</div>
</body>
</html>
